targetFileName ?= "glue.zip"
dependencies = unique(split("(:|;)", environment("java.class.path")))
bash = array("\#!/bin/bash")
bat = array("@echo off")

files = array()
for (dependency : dependencies)
	fileName = find(".*/(.*)", dependency)
	files = array(files, "lib/" + fileName[0] + "=" + dependency)
	switch($index)
		case (0)
			bash = array(bash, "export CLASSPATH=lib/" + fileName[0])
			bat = array(bat, "set CLASSPATH=lib/" + fileName[0])
		default
			bash = array(bash, "export CLASSPATH=$CLASSPATH:lib/" + fileName[0])
			bat = array(bat, "set CLASSPATH=%CLASSPATH%;lib/" + fileName[0])

bash = array(bash, "java -cp $CLASSPATH be.nabu.glue.Main label=version \"$@\"")
bat = array(bat, "java -cp %CLASSPATH% be.nabu.glue.Main label=version %*")

switch
	case (exists(environment("user.dir") + "/.glue"))
		environment = environment("user.dir") + "/.glue"
	case (exists(environment("user.home") + "/.glue"))
		environment = environment("user.home") + "/.glue"

zip = zip(array(files, environment, "glue.sh=" + join("\n", bash), "glue.bat=" + join("\r\n", bat)))
write(targetFileName, zip)
